{"ast":null,"code":"import { Type } from './Types';\nimport axios from 'axios';\nimport { push } from 'connected-react-router';\nimport { handleAxiosError } from './Utils';\n\nfunction persistToken(token) {\n  axios.defaults.headers.common['AUTHORIZATION'] = `Bearer ${token}`;\n  localStorage.setItem('token', token);\n}\n\nasync function fetchToken() {\n  const token = await localStorage.getItem('token');\n  axios.defaults.headers.common['AUTHORIZATION'] = `Bearer ${token}`;\n  return token;\n}\n\nexport const login = (username, password) => {\n  return async dispatch => {\n    // replace this with an api module assumedly\n    // const res = await axios.post('/api/login', {email, password})\n    // just an example\n    dispatch({\n      type: Type.LOGIN\n    });\n    let res;\n\n    try {\n      // TODO please don't hard-code this, we're working on getting nginx with\n      // docker\n      res = await axios.post('http://localhost:5000/auth/login', {\n        username,\n        password\n      });\n      persistToken(res.data.token);\n      dispatch({\n        type: Type.LOGIN_SUCCEEDED,\n        payload: true\n      });\n      const pushAction = push('/');\n      dispatch(pushAction);\n    } catch (e) {\n      // TODO failed, dispatch error\n      console.log(e);\n      handleAxiosError(e, dispatch, Type.LOGIN_FAILED);\n    }\n  };\n};\nexport const logout = () => {\n  return async dispatch => {\n    // TODO remove token from localStorage and send to backend to delete\n    localStorage.removeItem('token');\n    dispatch({\n      type: Type.LOGOUT\n    });\n  };\n};\nexport const register = (username, password) => {\n  return async dispatch => {\n    dispatch({\n      type: Type.REGISTER\n    });\n    let res;\n\n    try {\n      res = await axios.post('http://localhost:5000/auth/register', {\n        username,\n        password\n      });\n      persistToken(res.data.token);\n      dispatch({\n        type: Type.REGISTER_SUCCEEDED,\n        payload: true\n      });\n      const pushAction = push('/');\n      dispatch(pushAction);\n    } catch (e) {\n      // TODO failed, dispatch error\n      console.log('registration error', e);\n      handleAxiosError(e, dispatch, Type.REGISTER_FAILED);\n    }\n  };\n};\nexport const fetchAuthToken = () => {\n  return async dispatch => {\n    const token = await fetchToken();\n\n    if (token) {\n      dispatch({\n        type: Type.LOGIN_SUCCEEDED,\n        payload: true\n      });\n    }\n  };\n};","map":{"version":3,"sources":["/Users/akashlankala/Documents/CS 307/fortune-sprint_2_review/client-react/src/redux/actions/Auth.ts"],"names":["Type","axios","push","handleAxiosError","persistToken","token","defaults","headers","common","localStorage","setItem","fetchToken","getItem","login","username","password","dispatch","type","LOGIN","res","post","data","LOGIN_SUCCEEDED","payload","pushAction","e","console","log","LOGIN_FAILED","logout","removeItem","LOGOUT","register","REGISTER","REGISTER_SUCCEEDED","REGISTER_FAILED","fetchAuthToken"],"mappings":"AAAA,SAASA,IAAT,QAAqB,SAArB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAGA,SAAQC,IAAR,QAAmB,wBAAnB;AAEA,SAAQC,gBAAR,QAA+B,SAA/B;;AAUA,SAASC,YAAT,CAAsBC,KAAtB,EAAqC;AACnCJ,EAAAA,KAAK,CAACK,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,eAA9B,IAAkD,UAASH,KAAM,EAAjE;AACAI,EAAAA,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8BL,KAA9B;AACD;;AAED,eAAeM,UAAf,GAA4B;AAC1B,QAAMN,KAAK,GAAG,MAAMI,YAAY,CAACG,OAAb,CAAqB,OAArB,CAApB;AACAX,EAAAA,KAAK,CAACK,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,eAA9B,IAAkD,UAASH,KAAM,EAAjE;AACA,SAAOA,KAAP;AACD;;AAED,OAAO,MAAMQ,KAAK,GAAG,CAACC,QAAD,EAAmBC,QAAnB,KAAwC;AAC3D,SAAO,MAAOC,QAAP,IAAsC;AAC3C;AACA;AACA;AACAA,IAAAA,QAAQ,CAAC;AAACC,MAAAA,IAAI,EAAEjB,IAAI,CAACkB;AAAZ,KAAD,CAAR;AACA,QAAIC,GAAJ;;AACA,QAAI;AACF;AACA;AACAA,MAAAA,GAAG,GAAG,MAAMlB,KAAK,CAACmB,IAAN,CAAW,kCAAX,EAA+C;AAACN,QAAAA,QAAD;AAAWC,QAAAA;AAAX,OAA/C,CAAZ;AACAX,MAAAA,YAAY,CAACe,GAAG,CAACE,IAAJ,CAAShB,KAAV,CAAZ;AACAW,MAAAA,QAAQ,CAAC;AAACC,QAAAA,IAAI,EAAEjB,IAAI,CAACsB,eAAZ;AAA6BC,QAAAA,OAAO,EAAE;AAAtC,OAAD,CAAR;AACA,YAAMC,UAAe,GAAGtB,IAAI,CAAC,GAAD,CAA5B;AACAc,MAAAA,QAAQ,CAACQ,UAAD,CAAR;AACD,KARD,CAQE,OAAOC,CAAP,EAAU;AACV;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACAtB,MAAAA,gBAAgB,CAACsB,CAAD,EAAIT,QAAJ,EAAchB,IAAI,CAAC4B,YAAnB,CAAhB;AACD;AACF,GAnBD;AAoBD,CArBM;AAuBP,OAAO,MAAMC,MAAM,GAAG,MAAM;AAC1B,SAAO,MAAOb,QAAP,IAAsC;AAC3C;AACAP,IAAAA,YAAY,CAACqB,UAAb,CAAwB,OAAxB;AACAd,IAAAA,QAAQ,CAAC;AAACC,MAAAA,IAAI,EAAEjB,IAAI,CAAC+B;AAAZ,KAAD,CAAR;AACD,GAJD;AAKD,CANM;AAQP,OAAO,MAAMC,QAAQ,GAAG,CAAClB,QAAD,EAAmBC,QAAnB,KAAwC;AAC9D,SAAO,MAAOC,QAAP,IAAsC;AAC3CA,IAAAA,QAAQ,CAAC;AAACC,MAAAA,IAAI,EAAEjB,IAAI,CAACiC;AAAZ,KAAD,CAAR;AACA,QAAId,GAAJ;;AACA,QAAI;AACFA,MAAAA,GAAG,GAAG,MAAMlB,KAAK,CAACmB,IAAN,CAAW,qCAAX,EAAkD;AAACN,QAAAA,QAAD;AAAWC,QAAAA;AAAX,OAAlD,CAAZ;AACAX,MAAAA,YAAY,CAACe,GAAG,CAACE,IAAJ,CAAShB,KAAV,CAAZ;AACAW,MAAAA,QAAQ,CAAC;AAACC,QAAAA,IAAI,EAAEjB,IAAI,CAACkC,kBAAZ;AAAgCX,QAAAA,OAAO,EAAE;AAAzC,OAAD,CAAR;AACA,YAAMC,UAAe,GAAGtB,IAAI,CAAC,GAAD,CAA5B;AACAc,MAAAA,QAAQ,CAACQ,UAAD,CAAR;AACD,KAND,CAME,OAAOC,CAAP,EAAU;AACV;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkCF,CAAlC;AACAtB,MAAAA,gBAAgB,CAACsB,CAAD,EAAIT,QAAJ,EAAchB,IAAI,CAACmC,eAAnB,CAAhB;AACD;AACF,GAdD;AAeD,CAhBM;AAkBP,OAAO,MAAMC,cAAc,GAAG,MAAM;AAClC,SAAO,MAAOpB,QAAP,IAAsC;AAC3C,UAAMX,KAAK,GAAG,MAAMM,UAAU,EAA9B;;AACA,QAAIN,KAAJ,EAAW;AACTW,MAAAA,QAAQ,CAAC;AAACC,QAAAA,IAAI,EAAEjB,IAAI,CAACsB,eAAZ;AAA6BC,QAAAA,OAAO,EAAE;AAAtC,OAAD,CAAR;AACD;AACF,GALD;AAMD,CAPM","sourcesContent":["import { Type } from './Types'\nimport axios from 'axios'\nimport { Dispatch } from 'redux'\nimport { Action } from '../reducers/AuthReducer'\nimport {push} from 'connected-react-router'\n\nimport {handleAxiosError} from './Utils'\n\n\ntype AuthTokenResponse = {\n  data: {\n    token: string,\n    issued_at: Date,\n  }\n}\n\nfunction persistToken(token: string) {\n  axios.defaults.headers.common['AUTHORIZATION'] = `Bearer ${token}`\n  localStorage.setItem('token', token)\n}\n\nasync function fetchToken() {\n  const token = await localStorage.getItem('token')\n  axios.defaults.headers.common['AUTHORIZATION'] = `Bearer ${token}`\n  return token\n}\n\nexport const login = (username: string, password: string) => {\n  return async (dispatch: Dispatch<Action>) => {\n    // replace this with an api module assumedly\n    // const res = await axios.post('/api/login', {email, password})\n    // just an example\n    dispatch({type: Type.LOGIN})\n    let res: AuthTokenResponse\n    try {\n      // TODO please don't hard-code this, we're working on getting nginx with\n      // docker\n      res = await axios.post('http://localhost:5000/auth/login', {username, password})\n      persistToken(res.data.token)\n      dispatch({type: Type.LOGIN_SUCCEEDED, payload: true})\n      const pushAction: any = push('/')\n      dispatch(pushAction)\n    } catch (e) {\n      // TODO failed, dispatch error\n      console.log(e)\n      handleAxiosError(e, dispatch, Type.LOGIN_FAILED)\n    }\n  }\n}\n\nexport const logout = () => {\n  return async (dispatch: Dispatch<Action>) => {\n    // TODO remove token from localStorage and send to backend to delete\n    localStorage.removeItem('token')\n    dispatch({type: Type.LOGOUT})\n  }\n}\n\nexport const register = (username: string, password: string) => {\n  return async (dispatch: Dispatch<Action>) => {\n    dispatch({type: Type.REGISTER})\n    let res: AuthTokenResponse\n    try {\n      res = await axios.post('http://localhost:5000/auth/register', {username, password})\n      persistToken(res.data.token)\n      dispatch({type: Type.REGISTER_SUCCEEDED, payload: true})\n      const pushAction: any = push('/')\n      dispatch(pushAction)\n    } catch (e) {\n      // TODO failed, dispatch error\n      console.log('registration error', e)\n      handleAxiosError(e, dispatch, Type.REGISTER_FAILED)\n    }\n  }\n}\n\nexport const fetchAuthToken = () => {\n  return async (dispatch: Dispatch<Action>) => {\n    const token = await fetchToken()\n    if (token) {\n      dispatch({type: Type.LOGIN_SUCCEEDED, payload: true})\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}